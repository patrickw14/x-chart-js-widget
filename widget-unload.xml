<?xml version="1.0" encoding="UTF-8"?><record_update><m2m_sp_widget_dependency action="INSERT_OR_UPDATE"><sp_dependency display_value="chart.js">a7a8754347011200ba13a5554ee4905c</sp_dependency><sp_widget display_value="Chart.js">56c57d0347011200ba13a5554ee4906c</sp_widget><sys_class_name>m2m_sp_widget_dependency</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:19:51</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>b76a794347011200ba13a5554ee49007</sys_id><sys_mod_count>0</sys_mod_count><sys_name>chart.js.Sample Polar Chart</sys_name><sys_package display_value="Service Portal - Core" source="com.glide.service-portal">ac6ac531d713120023c84f80de6103f5</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>m2m_sp_widget_dependency_b76a794347011200ba13a5554ee49007</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-01-23 23:19:51</sys_updated_on></m2m_sp_widget_dependency><sp_dependency action="INSERT_OR_UPDATE"><module>chart.js</module><name>chart.js</name><page_load>false</page_load><sys_class_name>sp_dependency</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:12:20</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>a7a8754347011200ba13a5554ee4905c</sys_id><sys_mod_count>2</sys_mod_count><sys_name>chart.js</sys_name><sys_package display_value="Service Portal - Core" source="com.glide.service-portal">ac6ac531d713120023c84f80de6103f5</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_dependency_a7a8754347011200ba13a5554ee4905c</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-05-09 18:34:05</sys_updated_on></sp_dependency><m2m_sp_dependency_css_include action="INSERT_OR_UPDATE"><order>100</order><sp_css_include display_value="angular-chart.js">d2b6ca0347011200ba13a5554ee490a8</sp_css_include><sp_dependency display_value="chart.js">a7a8754347011200ba13a5554ee4905c</sp_dependency><sys_class_name>m2m_sp_dependency_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-24 00:14:20</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>e1e6ca0347011200ba13a5554ee49032</sys_id><sys_mod_count>0</sys_mod_count><sys_name>angular-chart.js.chart.js</sys_name><sys_package display_value="Service Portal Test Pages" source="com.glide.service-portal.test">10ca4971d713120023c84f80de6103d9</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>m2m_sp_dependency_css_include_e1e6ca0347011200ba13a5554ee49032</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-01-24 00:14:20</sys_updated_on></m2m_sp_dependency_css_include><sp_css_include action="INSERT_OR_UPDATE"><name>angular-chart.js</name><source>url</source><sp_css/><sys_class_name>sp_css_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-24 00:14:20</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>d2b6ca0347011200ba13a5554ee490a8</sys_id><sys_mod_count>0</sys_mod_count><sys_name>angular-chart.js</sys_name><sys_package display_value="Service Portal Test Pages" source="com.glide.service-portal.test">10ca4971d713120023c84f80de6103d9</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_css_include_d2b6ca0347011200ba13a5554ee490a8</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-01-24 00:14:20</sys_updated_on><url>/scripts/thirdparty/angular-chart/angular-chart.css</url></sp_css_include><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>100</order><sp_dependency display_value="chart.js">a7a8754347011200ba13a5554ee4905c</sp_dependency><sp_js_include display_value="/scripts/thirdparty/angular-chart/chart.js">0898754347011200ba13a5554ee49019</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:19:25</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>555a394347011200ba13a5554ee490ab</sys_id><sys_mod_count>0</sys_mod_count><sys_name>chart.js.chart.js</sys_name><sys_package display_value="Service Portal - Core" source="com.glide.service-portal">ac6ac531d713120023c84f80de6103f5</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>m2m_sp_dependency_js_include_555a394347011200ba13a5554ee490ab</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-01-23 23:19:25</sys_updated_on></m2m_sp_dependency_js_include><sp_js_include action="INSERT_OR_UPDATE"><display_name>/scripts/thirdparty/angular-chart/chart.js</display_name><source>url</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:12:03</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>0898754347011200ba13a5554ee49019</sys_id><sys_mod_count>5</sys_mod_count><sys_name>/scripts/thirdparty/angular-chart/chart.js</sys_name><sys_package display_value="Service Portal - Core" source="com.glide.service-portal">ac6ac531d713120023c84f80de6103f5</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_ui_script/><sys_update_name>sp_js_include_0898754347011200ba13a5554ee49019</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-02-26 16:54:24</sys_updated_on><url>/scripts/thirdparty/angular-chart/chart.js</url></sp_js_include><m2m_sp_dependency_js_include action="INSERT_OR_UPDATE"><order>200</order><sp_dependency display_value="chart.js">a7a8754347011200ba13a5554ee4905c</sp_dependency><sp_js_include display_value="/scripts/thirdparty/angular-chart/angular-chart.js">6b38354347011200ba13a5554ee490ad</sp_js_include><sys_class_name>m2m_sp_dependency_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:19:25</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>dd5a394347011200ba13a5554ee490aa</sys_id><sys_mod_count>1</sys_mod_count><sys_name>chart.js.angular-chart.js</sys_name><sys_package display_value="Service Portal - Core" source="com.glide.service-portal">ac6ac531d713120023c84f80de6103f5</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>m2m_sp_dependency_js_include_dd5a394347011200ba13a5554ee490aa</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-01-23 23:19:32</sys_updated_on></m2m_sp_dependency_js_include><sp_js_include action="INSERT_OR_UPDATE"><display_name>/scripts/thirdparty/angular-chart/angular-chart.js</display_name><source>url</source><sys_class_name>sp_js_include</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:10:55</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>6b38354347011200ba13a5554ee490ad</sys_id><sys_mod_count>4</sys_mod_count><sys_name>/scripts/thirdparty/angular-chart/angular-chart.js</sys_name><sys_package display_value="Service Portal - Core" source="com.glide.service-portal">ac6ac531d713120023c84f80de6103f5</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_ui_script/><sys_update_name>sp_js_include_6b38354347011200ba13a5554ee490ad</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-02-26 16:54:31</sys_updated_on><url>/scripts/thirdparty/angular-chart/angular-chart.js</url></sp_js_include><sp_widget action="INSERT_OR_UPDATE"><client_script><![CDATA[function ($scope, $location, spUtil) {
	console.log("this is a change");
	var c = this;
	c.type = c.options.c_type || 'Doughnut';

	if (!c.options.table)
		return;

	spUtil.recordWatch($scope, c.options.table, c.options.filter);

	// drilldown
	c.onClick = function (points, evt) {
		var p = points[0];
		for (var i = 0; i < c.data.labels.length; i++) {
			if (p.label != c.data.labels[i])
				continue;

			var f =  c.options.display_field + '=' + c.data.field_values[i];
			f = c.options.filter + "^" + f;
			var search = {
				id: 'lf',
				table: c.options.table,
				filter: f
			}
			$location.search(search);
			return;
		}
  }
	
	$scope.$watch('c.options.c_type', function(nV, oV) {
		c.type = nV || 'Doughnut';
	})
	
}]]></client_script><controller_as>c</controller_as><css/><data_table>sp_instance_table</data_table><demo_data>{}</demo_data><description>Create a pie chart or a doughnut chart from a query.</description><docs display_value="Chart.js">37cdcb60d731120023c84f80de6103ac</docs><field_list>title,table,filter,color,glyph,display_field</field_list><has_preview>false</has_preview><id/><internal>false</internal><link/><name>Chart.js</name><option_schema>[{"name":"c_type","label":"Chart type","type":"choice","choices":[{"label":"Pie","value":"Pie"},{"label":"Doughnut","value":"Doughnut"},{"label":"Bar","value":"Bar"}]}]</option_schema><public>false</public><roles/><script><![CDATA[(function() {
	if (!options.table)
		return;

	var opts = {
		"Pie" : {
			segmentShowStroke: false
		},
		"Doughnut" : {
			segmentShowStroke: false,
			animationEasing : "easeOutQuart"
		},
		"Bar" : {
			barShowStroke: false,
			legendTemplate: ""
		}
	};
	
	data.chartOptions = opts[options.c_type];
	
	var ga = new GlideAggregate(options.table);
	ga.addEncodedQuery(options.filter);
	var f = options.display_field;
	ga.addAggregate('COUNT', f);
	ga.query();
	
	if (options.c_type == "Bar"){
		var values = [];
		data.labels = [];
		data.field_values = [];
		
		while (ga.next()) {
			data.labels.push(ga.getDisplayValue(f) || "(" + gs.getMessage("empty") + ")");
			values.push(ga.getAggregate('COUNT', f));
			data.field_values.push(ga.getValue(f));
		}
		
    data.values = [];
		data.values.push(values);
	} else {
		data.labels = [];
		data.values = [];
		data.field_values = [];

		while (ga.next()) {
			data.labels.push(ga.getDisplayValue(f) || "(" + gs.getMessage("empty") + ")");
			data.values.push(ga.getAggregate('COUNT', f));
			data.field_values.push(ga.getValue(f));
		}
	}
})()]]></script><servicenow>true</servicenow><sys_class_name>sp_widget</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-01-23 23:01:43</sys_created_on><sys_customer_update>false</sys_customer_update><sys_id>56c57d0347011200ba13a5554ee4906c</sys_id><sys_mod_count>144</sys_mod_count><sys_name>Chart.js</sys_name><sys_package display_value="Service Portal Test Pages" source="com.glide.service-portal.test">10ca4971d713120023c84f80de6103d9</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_widget_56c57d0347011200ba13a5554ee4906c</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-05-12 22:48:14</sys_updated_on><template><![CDATA[<div class="panel panel-{{::c.options.color}} b">
  <div class="panel-heading">
    <h4 class="m-n">
      <span ng-if="::c.options.glyph">
        <fa name="{{::c.options.glyph}}" />
      </span>
      {{c.options.title}}</h4>
  </div>
  <div class="panel-body">
    <canvas id="base" class="chart-base"
            chart-type="c.type"
            chart-data="c.data.values"
            chart-labels="c.data.labels"
            chart-click="c.onClick"
            chart="chart"
            chart-options="c.data.chartOptions"
            chart-legend="true">
    </canvas>
  </div>
</div>]]></template></sp_widget></record_update>
